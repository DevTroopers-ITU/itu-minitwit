services:
  webserver:
    build: .                     # Build image from Dockerfile
    image: minitwit/myserver      # Name/tag of the image
    ports:
      - "8080:8080"              # Host port â†’ container port
    volumes:
      - minitwit-db:/tmp         # Persist DB across container restarts
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080"]  # Check if app is running
      interval: 30s              # Check every 30 seconds
      timeout: 10s               # Fail if no response in 10 seconds
      retries: 3                 # Mark unhealthy after 3 failures

  clidownload:
    image: appropriate/curl      # Simple container with curl
    depends_on:
      webserver:
        condition: service_healthy  # Wait until webserver is healthy
    entrypoint: sh -c "curl -s http://webserver:8080"  # Call the webserver

volumes:
  minitwit-db:
